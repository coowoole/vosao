<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:util="http://www.springframework.org/schema/util"
       xmlns:p="http://www.springframework.org/schema/p"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd
           http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd
           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.5.xsd">


    <!-- Persistence -->

    <bean id="persistenceManagerFactory"  
        class="org.springframework.orm.jdo.LocalPersistenceManagerFactoryBean">  
        <!-- property name="persistenceManagerFactoryName" value="transactions-optional" /-->
        <property name="jdoProperties">
            <props>
                <prop key="javax.jdo.PersistenceManagerFactoryClass">org.datanucleus.store.appengine.jdo.DatastoreJDOPersistenceManagerFactory</prop>
                <prop key="javax.jdo.option.ConnectionURL">appengine</prop>
                <prop key="javax.jdo.option.NontransactionalRead">true</prop>
                <prop key="javax.jdo.option.NontransactionalWrite">true</prop>
                <prop key="javax.jdo.option.RetainValues">true</prop>
                <prop key="datanucleus.appengine.autoCreateDatastoreTxns">true</prop>
            </props>
        </property>
    </bean>  

    <!-- bean id="persistenceManagerFactoryProxy" 
        class="org.springframework.orm.jdo.TransactionAwarePersistenceManagerFactoryProxy">  
        <property name="targetPersistenceManagerFactory" ref="persistenceManagerFactory" />  
        <property name="allowCreate" value="true" />  
    </bean-->  
   
    <!-- bean id="transactionManager"
        class="org.springframework.orm.jdo.JdoTransactionManager">  
        <property name="persistenceManagerFactory" ref="persistenceManagerFactoryProxy" />  
    </bean-->

    <!-- Transactions -->

    <!-- tx:advice id="txAdvice">
        <tx:attributes>
            <tx:method name="*"/>
        </tx:attributes>
    </tx:advice>

    <aop:config>
        <aop:pointcut id="daoMethods" expression="execution(* org.vosao.dao.*.*(..))" />  
        <aop:advisor advice-ref="txAdvice" pointcut-ref="daoMethods" />  
    </aop:config--> 
    
    <!-- DAO -->
    
    <bean id="pageDao" class="org.vosao.dao.impl.PageDaoImpl" scope="singleton">  
        <property name="persistenceManagerFactory" ref="persistenceManagerFactory"/>  
    </bean>
    
    <!-- JSF beans -->

    <bean id="testBean" class="TestBean" init-method="init" scope="request">
        <property name="pageDao" ref="pageDao" />
    </bean>

</beans>
